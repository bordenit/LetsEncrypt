---
- hosts: localhost
  connection: local
  tasks:
    - include: setfacts.yml
    
    - include: installDependencies.yml
    
    - include: dockerHubLogin.yml

    - name: Build, Tag, and Push to Docker Hub
      become: true
      docker_image:
        build:
          path: "{{hostvars['localhost']['commitSHA']}}"
          dockerfile: dotnet3.Dockerfile
          pull: yes
        name: "{{ hostvars['localhost']['dockerHubContainerName'] }}"
        repository: "{{ hostvars['localhost']['dockerHubUsername'] }}/{{ hostvars['localhost']['dockerHubContainerName'] }}"
        push: yes
        tag: "{{hostvars[inventory_hostname].ansible_distribution_version}}"
        source: build
        state: present

    - include: dockerHubLogout.yml
