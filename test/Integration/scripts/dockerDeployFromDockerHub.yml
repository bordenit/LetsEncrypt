---
- hosts: all
  tasks:
    - name: Install Python3
      yum:
        name: python3
        state: present
        
    - name: Install PIP
      yum:
        name: python3-pip
        state: present
        
    - name: Install Docker Python Module
      pip:
        name: docker

    - include_tasks: dockerHubLogin.yml

    - name: Start Ubuntu Containers
      docker_container: 
          name: "{{ansible_env.dockerHubContainerName}}"
          image: "{{ansible_env.dockerHubUsername}}/{{ansible_env.dockerContainerName}}"
          pull: yes
          state: started
          network_mode: bridge
          published_ports:
            - "80:80"
            - "443:443"
          volumes:
            - "~/x509stores/:/root/.dotnet/corefx/cryptography/x509stores/"
          env:
            ASPNETCORE_ENVIRONMENT: "{{ hostvars['localhost']['ASPNETCORE_ENVIRONMENT']}}"
            ASPNETCORE_URLS: "http://+;https://+"
            ASPNETCORE_HTTPS_PORT: "443"
            commitSHA: "{{ hostvars['localhost']['commitSHA'] }}"

    - include_tasks: dockerHubLogout.yml